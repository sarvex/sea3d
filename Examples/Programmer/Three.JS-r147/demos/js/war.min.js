// three.js / threejs.org/license
'use strict';var WAR={REVISION:"0.1",FPS:60,MAX_SPEED:2.35,canvasWidth:1E3,canvasHeight:1E3,mousePoint:null,isPeace:!1,Debug:!1,Simulator:function(a,b){this.people=a||30;this.draw=!1;this.context=null;this.canvas=b||null;this.deadPool=[];this.boids=[];this.bloodstains=[];this.boidTypes=[];WAR.mousePoint=new WAR.Point;this.clickCount=0}};
WAR.Simulator.prototype={constructor:WAR.Simulator,init:function(){this.boidTypes=[new WAR.BoidType("a","b",["c","d"],"rgba(250, 185, 15, 1)",0),new WAR.BoidType("b","c",["a","d"],"rgba(165, 240, 20, 1)",1),new WAR.BoidType("c","a",["b","d"],"rgba(20, 135, 240, 1)",2),new WAR.BoidType("d",["a","c","b"],!1,"rgba(255, 0, 255, 1)",3)];for(var a=this.people;a--;)this.createBoid(Math.random()*WAR.canvasWidth,Math.random()*WAR.canvasHeight,this.boidTypes[Math.floor(3*Math.random())])},createBoid:function(a,
b,c){a=new WAR.Boid(a,b,c,0.6*Math.random()-0.3,0.6*Math.random()-0.3);this.boids.push(a)},resize:function(a,b){WAR.canvasWidth=a;WAR.canvasHeight=b},setMouse:function(a,b){WAR.mousePoint.x=a;WAR.mousePoint.y=b},addOnMouse:function(a,b){var c=Math.floor(4*Math.random()),e=3;for(3==c&&(e=1);e--;)this.createBoid(a,b,this.boidTypes[c])},add:function(a,b,c){var e=c||3;c=this.clickCount%(3+Math.floor(0.9*Math.random()+0.2));for(e=c===e?1:e;e--;)this.createBoid(a,b,this.boidTypes[c]);this.clickCount++},
removeKiller:function(){for(var a,b=0,c=this.boids.length;b<c;b++)a=this.boids[b],"d"===a.type.name&&(this.boids.splice(b,1),c--,b--)},setPeace:function(a){WAR.isPeace=a},peace:function(){WAR.isPeace=!WAR.isPeace},debug:function(){},loop:function(){for(var a=this.boids.length;a--;){var b=this.boids[a];b.update(this.boids);b.isDead&&(this.boids.splice(a,1),this.deadPool.push(a))}}};
WAR.Boid=function(a,b,c,e,d){this.x=a||0;this.y=b||0;this.r=0;this.type=c;this.v=new WAR.BoidVelocity(this,e,d);this.isDead=!1;this._time=(new Date).getTime();this._op={};this._dv=this.v.clone()};
WAR.Boid.prototype={constructor:WAR.Boid,update:function(a){if(!this.isDead){for(var b=a.length,c=this.v,e=this.type,d=this._op,l=0;l<b;l++){var f=a[l];if(f!==this){var k=(new WAR.Point).distance(this,f),h=Infinity,g=WAR.canvasWidth-80,m=WAR.canvasHeight-80;d.x=f.x;d.y=f.y;80>this.x&&f.x>g?d.x-=WAR.canvasWidth:this.x>g&&80>f.x&&(d.x+=WAR.canvasWidth);80>this.y&&f.y>m?d.y-=WAR.canvasHeight:this.y>m&&80>f.y&&(d.y+=WAR.canvasHeight);if(d.x!==f.x||d.y!==f.y)h=(new WAR.Point).distance(this,d);g=!1;if(e.isFamily(f.type)||
WAR.isPeace)25>k||(g=25>h)?c.separation(g?d:f,g?h:k):35>k||35>h?c.alingment(f.v):(100>k||(g=100>h))&&c.cohesion(g?d:f);else if(120>k||(g=120>h))if(e.isTarget(f.type))c.cohesion(g?d:f,2);else if(e.isEnemy(f.type)){if(1E3<(new Date).getTime()-this._time&&(10>k||10>h)){this.isDead=!0;return}(100>k||(g=100>h))&&c.separation(g?d:f,g?h:k,3)}}}a=(new WAR.Point).distance(this,WAR.mousePoint);80>a&&c.separation(WAR.mousePoint,a,5);a=this.x;b=this.y;c.applyVelocity();this.x+=c.x;this.y+=c.y;this.r=Math.atan2(a-
this.x,b-this.y);0>this.x?this.x+=WAR.canvasWidth:this.x>WAR.canvasWidth&&(this.x-=WAR.canvasWidth);0>this.y?this.y+=WAR.canvasHeight:this.y>WAR.canvasHeight&&(this.y-=WAR.canvasHeight)}}};WAR.BoidType=function(a,b,c,e,d){this.name=a;this.target=b;this.enemy=c;this.color=e;this.id=d};
WAR.BoidType.prototype={constructor:WAR.BoidType,isFamily:function(a){return this._is("name",a)},isTarget:function(a){return this._is("target",a)},isEnemy:function(a){return this._is("enemy",a)},_is:function(a,b){b instanceof WAR.BoidType&&(b=b.name);if(this[a]instanceof Array){for(var c=0,e=this[a].length;c<e;c++)if(this[a][c]===b)return!0;return!1}return this[a]===b}};WAR.Point=function(a,b){this.x=a||0;this.y=b||0};
WAR.Point.prototype={constructor:WAR.Point,equals:function(a,b){return a.x==b.x&&a.y==b.y},angle:function(a){return Math.atan2(a.y,a.x)},distance:function(a,b){var c=a.x-b.x,e=a.y-b.y;return Math.sqrt(c*c+e*e)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},dot:function(a,b){return a.x*b.x+a.y*b.y},cross:function(a,b){return a.x*b.y-a.y*b.x},polar:function(a,b){return new WAR.Point(a*Math.sin(b),a*Math.cos(b))},set:function(a,b){this.x=a||0;this.y=b||0;return this},offset:function(a,
b){this.x+=a||0;this.y+=b||0;return this},normalize:function(a){a=a||1;var b=this.length();0<b&&(this.x=this.x/b*a,this.y=this.y/b*a);return this},negate:function(){this.x*=-1;this.y*=-1;return this},clone:function(){return new WAR.Point(this.x,this.y)},toArray:function(){return[this.x,this.y]},toString:function(){return"(x:"+this.x+", y:"+this.y+")"}};WAR.BoidVelocity=function(a,b,c){WAR.Point.call(this);this.target=a;this.x=b||0;this.y=c||0;this.dispose()};WAR.BoidVelocity.prototype=Object.create(WAR.Point.prototype);
WAR.BoidVelocity.prototype.separation=function(a,b,c){"undefined"===typeof c&&(c=1);b=1>b?1:1/b;this.sx-=(a.x-this.target.x)*b*c;this.sy-=(a.y-this.target.y)*b*c;this.sc++};WAR.BoidVelocity.prototype.alingment=function(a){this.ax+=a.x;this.ay+=a.y;this.ac++};WAR.BoidVelocity.prototype.cohesion=function(a){this.cx+=a.x;this.cy+=a.y;this.cc++};
WAR.BoidVelocity.prototype.applyVelocity=function(){this.sc&&(this.x+=this.sx/this.sc,this.y+=this.sy/this.sc);this.ac&&(this.x+=0.125*(this.ax/this.ac-this.x),this.y+=0.125*(this.ay/this.ac-this.y));this.cc&&(this.x+=0.005*(this.cx/this.cc-this.target.x),this.y+=0.005*(this.cy/this.cc-this.target.y));this.length()>WAR.MAX_SPEED&&this.normalize(WAR.MAX_SPEED);this.dispose()};WAR.BoidVelocity.prototype.dispose=function(){this.cx=this.cy=this.cc=this.ax=this.ay=this.ac=this.sx=this.sy=this.sc=0};
